#!/usr/bin/env node

import fs from 'fs'
import path from 'path'
import del from 'del'
import le from 'letiny'

const paths = {}
paths.static = path.join(__dirname, '..', 'static')
paths.certs = path.normalize('/etc/ssl/private/simonkjellberg.com')
paths.chain = path.join(paths.certs, 'chain.pem')

const options ={
  email: 'admin@simonkjellberg.com',
  domains: [
    'simonkjellberg.com',
    'www.simonkjellberg.com',
    'simonkjellberg.se',
    'www.simonkjellberg.se',
  ],
  webroot: paths.static,
  certFile: path.join(paths.certs, 'cert.pem'),
  caFile: path.join(paths.certs, 'ca.pem'),
  privateKey: path.join(paths.certs, 'key.pem'),
  accountKey: path.join(paths.certs, 'account.pem'),
  agreeTerms: true
}

le.getCert(options, (err, cert, privateKey, ca, accountKey) => {
  if (err) throw err

  fs.writeFileSync(paths.chain, cert)
  fs.appendFileSync(paths.chain, ca)

  del(path.join(paths.static, '.well-known'))
})
